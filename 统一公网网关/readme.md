# 统一公网网关竞品分析

## NSDI'24 | 阿里云飞天洛神云网络论文解读——《LuoShen》揭秘新型融合网关 洛神云网关

<https://mp.weixin.qq.com/s/RZpnq9nWej5qDdBsSlGMgQ>

## P4可编程设备在工业界的落地情况

<https://zhuanlan.zhihu.com/p/373356027>

## XGW 阿里云基于Intel 可编程芯片 Tofino 设计的流量分发网关

XGW 是阿里云基于Intel 可编程芯片 Tofino 设计的流量分发网关，如上图所示，其负责公网、专线、跨Region之间流量汇聚与分发，支持IPv6。 典型产品有：EIP和共享带宽限制、专线（比如天猫双11或某大客户数10Tbps专线上云流量）、CEN等。

## 腾讯网关TGW架构演进之路

<https://zhuanlan.zhihu.com/p/673606795>

TGW主要有两大产品：一个是弹性EIP，比如购买一台虚拟机CVM或是一个NAT实例后，通过EIP连通外网；另一个是四层CLB，一般分为内网CLB和外网CLB，内网CLB是在vpc内创建一个CLB实例，把多个CVM服务挂在了内网CLB上，为后端RS提供负载均衡的能力；外网CLB面对的是公网侧负载均衡的需求。当在内部部署CLB集群时，可分为IPV4或者IPV6两大类，根据物理网络类型又细分为BGP和三网两类。三网指这些IP地址是静态的，不像BGP一样能够在多个运营商之间同时进行广播。

## 中国电信天翼云发布首款自研P4可编程白盒交换机

<https://mp.weixin.qq.com/s/pM55v63BBzRTCJNjCtovIA>

**应用场景**

天翼云采用P4可编程白盒交换机实现了云间高速网关和公网网关。使用集群化部署的方式，实现了平滑的水平扩容能力，降低现网用户剧增带来的风险；T级别带宽能力完美的解决了x86形态的带宽处理能力；单台故障时仅影响该台设备增量，将影响降低到最低。同时做到了无损迁移，整个迁移过程流量无抖动。

**云间高速网关**

天翼云采用P4可编程白盒交换机实现了云间高速网关。该网关实现了多实例、虚拟私有云（VPC）、云专线、SD-WAN、VPN接入。在支持IPv4、IPv6双栈的同时满足了用户对路由的大规格需求，简化了用户配置路由的繁琐操作，单台设备的路由规格达到40万+。

**公网网关**

天翼云采用P4可编程白盒交换机实现了公网网关。该网关实现了x86形态数据面的全量功能，例如：流量转发，流量统计、流量限速，协议流量识别处理等。在支持IPv4、IPv6双栈的同时满足了大规模数据中心对公网IP的大规格需求，单台设备的IP规格达到10万个。

# 统一公网网关优势
## 基于barefoot演进跟进业内的技术发展

[IGW 产品竞聘分析](#统一公网网关竞品分析)

## 基于barefoot国产设备，达成信创目标

传统的X86和之前采购的barefoot设备，大都是国外芯片

当前国产芯片的barefoot设备，例如：华为/中兴等具有国产可替代

## 基于barefoot设备成本更低

传统的X86部署dpdk版本需要大量的机器，造价成本高

## 软件旧版没有精准限速的能力

之前软件限速同时为了做软件组内互备，每个软件节点限速为75%，总限速为1.5倍

之前软件限速使用GTC分布式实时计算，GTC计算器秒级的限速分配不均衡

之前带宽包内的IP加入和移除，会出现切换瞬间限速丢失流量黑洞

优势：

1.产品体验上看

用户配置规格和实际实现一致

2.架构角度看

a。统一的公网集中限速将公网IP的能力收敛

b。采用集群内和集群间导流技术，去除了GTC和软件等其他组件

## 软件旧版没有多组互相灾备能力，同时没有异构的能力

集群版本下，多个igw集群之间可以相互宣告相同的vip，靠路由自动故障转移

igw集群的设计在segment的宣告引流使用as_path控制，故障期间可以降级至旧的dpdk版本

优势：

1.稳定性角度看

a。异构的设计，可以避免硬件或者编程语言的问题

b。大小vip的宣告，可以在单个集群故障时快速自动灾备

2.架构角度看，直接大小段的vip宣告，不涉及其他模块开发和适配工作，架构简单